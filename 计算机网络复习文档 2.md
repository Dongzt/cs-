## 第一章 概述

### 基本概念

1. 网络协议三要素：语法，语义，时序

2. 计算机网络拓扑结构

   - 星状拓扑：结构简单，较好的健壮性，便于管理、安全控制，中央控制器是网络的瓶颈，单点失效。
   - 总线型拓扑：不存在路由，易安装，总线长度有限，设备数受限，故障隔离问题。
   - 网状拓扑：避免拥塞问题，较好的健壮性，好的安全性，易管理，费用高。

3. OSI7层：

   | OSI            | 传输单位     | 功能                                                         | 协议                                                 |
   | -------------- | ------------ | :----------------------------------------------------------- | ---------------------------------------------------- |
   | **物理层**     | 比特 bit     | 机械特性，电气特性，功能特性，规程特性                       |                                                      |
   | **数据链路层** | 帧 frame     | 分帧、排序，差错控制，流量控制，链路管理                     | HDLC                                                 |
   | **网络层**     | 分组 packet  | 路由选择，阻塞控制，网际互连                                 | IP,ARP,ICMP,IGMP,OSPF(内部网关路由选择)，BGPv4(外部) |
   | **传输层**     | 报文 message | 端到端的流量控制，端到端的差错控制                           | TCP UDP                                              |
   | 会话层         |              | 两个计算机上的用户进程建立连接，双方互相确认身份，协商会话连接的细节 |                                                      |
   | 表示层         |              | 解决用户信息的语法问题，对用户数据进行翻译、编码和交换       |                                                      |
   | **应用层**     |              | 处理用户的数据和信息，完成用户所希望的实际任务               | HTTP,DNS,SMTP,POP,FTP,DHCP                           |

4. 实通信：层间通信和物理层之间的通信

   虚通信：除物理层之外，对等层间的通信

5. <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227171537782.png" alt="image-20230227171537782" style="zoom: 50%;" />

6. 网络互连设备

   | 设备   | 工作层                     | 功能                               |
   | ------ | -------------------------- | ---------------------------------- |
   | 集线器 | 物理层                     | 通过放大信号，扩展网络的物理网段   |
   | 网桥   | 物理层和数据链路层         | 在数据链路层进行数据帧的存贮和转发 |
   | 路由器 | 物理层、数据链路层和网络层 | 连接多个网络                       |
   | 网关   | 可以工作在OSI的所有7层     | 协议转换器，能互连异类的网络       |

7. 计算机网络性能指标

   ![image-20230227173552670](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227173552670.png)

   ![image-20230227173626804](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227173626804.png)

   

## 第二章 数据通信基础

### 基本概念

1. <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227184728515.png" alt="image-20230227184728515" style="zoom: 40%;" />

   <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227185050346.png" alt="image-20230227185050346" style="zoom:40%;" />

### ==两个速率公式==

1. ![image-20230227185405172](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227185405172.png)

2. ![image-20230227185844806](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227185844806.png)

### 信号与编码

1. 基带信号经**调制**后成为**带通信号**

​		调制方法：调幅(AM)，调频(FM)，调相(PM)

2. 数字-数字编码

![image-20230304165644210](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230304165644210.png)

​		**曼彻斯特编码(MPE):负电平到正电平跳变代表比特1，正电平到负电平跳变代表0**

​		差分曼彻斯特编码：比特间隙开始时刻发生跳变代表0

3. 数字-模拟编码

- 幅移键控(ASK—Amplitude Shift Key)

- 频移键控(FSK—Frequency Shift Key)

- 相移键控(PSK—Phase Shift Key)

- 正交调幅(QAM—Quadrature Amplitude Modulation)

​		模拟-数字编码：采样，量化，编码

### 多路复用技术

1. 

   |                      | 适用信号 |
   | :------------------: | -------- |
   |     频分（FDM）      | 模拟信号 |
   | 时分（TDM）同步/异步 | 数字信号 |
   |     波分（WDM）      | 光信号   |
   |     码分（CDM）      |          |

2. **码分多址复用CDMA**

   - 假定每比特有8个码片

   - 双极性编码：-1代替0，+1代替1

   - 每个站点都有自己唯一的码片序列

     - 发送比特1，站点就发送其码片序列
     - 发送比特0，站点就发送其码片序列的反码

   - 正交性：

     <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227201913543.png" alt="image-20230227201913543" style="zoom:50%;" />

   - 发送时，把发送信息的站点的码片各位相加；还原时，利用正交性获得某站点发送的比特流

### 数据交换技术

1. 电路交换，分组交换，报文交换

![image-20230227202834239](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227202834239.png)

2. 虚电路交换

   - 交换虚电路(SVC)：每条虚电路在需要的时候被创建，而且仅仅在这次通信交换的过程中存在。

   - 永久虚电路(PVC)：类似于租用线路，在这种方法中，两个用户之间存在一条相同的虚电路，该电路是专门提供给特定用户的，这条虚电路总是建立好的。

   优点：在采用虚电路的情况下，**仅在建立虚电路时需要目的地址**，而进行数据传送时， 每个包不需要携带完整的目的地址，而仅需要一个虚电路的号码标志。这就减少了包的控制信息，从而减少了额外开销。

### ==错误检测==

- 通信双方约定一个生成多项式G(x)，最高阶为m；

​		例：G(x)=x4+x3+1=11001，即m=4

- 设待发送的信息为U(x)；

​		例：1101011

​		在U(x)后面**添m个零**后除(异或)以G(x)得m位余数R(x)。

- 将R(x)放在U(x)之后得循环校验码。
- 接收方用收到的数据除以生成多项式G(x)，如果结果为0，传输没有错误，否则，说明传输产生错误。



## 第三章 物理层

1. 物理层的网络设备：中继器、集线器
2. 双绞线绞合的作用：抵御部分来自外界的电磁波干扰，减少相邻导线的电磁干扰



## 第四章 数据链路层

### 线路规程

- 询问/确认方式（ENQ/ACK）（点对点）

- 轮询/选择方式（Poll/Select）（多点链接）

### ==流量控制与差错控制==

1. 停止等待协议![image-20230227212832990](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230227212832990.png)

- 发送方每发送一帧后就等待应答。只有收到一个应答(ACK)后，才发送下一个帧，直到发送方发送一个传输结束帧。

- **完成一帧发送所需的最短时间 t~W~=t~I~+2t~P~+2t~Proc~+t~S~**

​				t~I~：发送数据帧时间=帧长/数据传输率

​				t~S~：发送确认帧时间=确认帧长/数据传输率

​				t~P~：信号传输延时=距离/信号传输速度

​				t~Proc~：节点处理数据时间

- 当出错率为*p*时，正确发送一帧的平均时间间隔为 t~V~=t~W~/(1-*p*) 

- **吞吐量和传输效率**

  <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230305202237502.png" alt="image-20230305202237502" style="zoom:50%;" />

- 差错控制使用ARQ技术， 处理错误的三种情况：帧破坏，帧丢失，应答帧丢失

2. ==回退N协议==

   ![image-20230228100146644](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228100146644.png)

​	吉大教材要求发送窗口尺寸为n-1

3. ==选择重传协议==

   ![image-20230228100412398](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228100412398.png)

- 吉大教材要求发送窗口尺寸和接收窗口尺寸之和应小于或等于n
- 假设一个帧的发送时间为t~I~，传播时间为t~P~，则**窗口的大小*n*应该满足如下条件 nt~I~>2(t~I~+t~P~)**

- 不考虑应答帧的丢失，正确传送一帧所需的平均时间为：   

  t~V~=t~I~+*p*t~W~/(1-*p*)

### ==HDLC通信协议==

1. 帧格式

<img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228104146463.png" alt="image-20230228104146463" style="zoom: 33%;" />

- 标志域：01111110（7E），标志域外采用**位填充法**，即每连续5个1，后面插入1个0

- 地址域：从站地址，若帧由主站发送，则表示接收该帧的从站地址。若帧由从站发送，则表示发送该帧的从站地址。若地址字段有多个字节，除最后一个字节外其他所有字节都要以0结尾，最后一个字节要以1结尾。

- 控制域：

  <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228105452332.png" alt="image-20230228105452332" style="zoom:50%;" />

  - I-帧：N(S)位，当前发送帧的编号；P/F=0，表示还有要发送的帧，P/F=1，表示没有要发送的帧，发送结束；N(R)位，期望收到的帧编号
  - S-帧：当不能在一个I-帧上捎带确认信息时，例如它没有数据信息可发时，用S-帧来对收到的数据帧进行应答。N(R)就是期望收到的帧的编号。
  - U-帧：U-帧中的P/F位一般都应置1。

  无论是I-帧、U-帧、S-帧，P/F位置1的数据帧和命令帧都是要立即进行响应的帧。

- 信息域：S-帧中没有信息字段。I-帧的信息字段是**用户数据信息**。U-帧中的信息字段是**链路管理信息**。
- 帧校验序列：HDLC协议的错误检测字段，含有一个两字节或四字节的循环冗余校验(CRC)码

2. 监控帧的使用

- ==接收就绪(RR)帧==：
  - 应答(ACK)：接收站本身没有数据信息发送时，作为应答帧来对所接收的数据帧进行应答。
  - 查询(POLL) ：当主站点询问从站点是否有数据发送时，它向从站点发送一个P/F位置1的RR帧。
  - 对查询的否定应答(POLL.NAK) ：从站点用一个P/F位置1的RR帧回答主站点的查询，通知主站点它没有数据发送。如果从站点有数据发送，从站点用I-帧来响应查询。
  - 对选择的肯定应答(SEL.ACK) ：如果从站点收到了主站点的选择帧，并且从站点准备好从主站接收数据，它用一个P/F位置1的RR帧回答主站点的选择。
- ==接收未就绪(RNR)帧==：
  - 应答(ACK)：接收方向发送方返回的RNR帧，表示接收方收到了编号在N(R)以前的所有帧，并要求发送方暂停发送，直到发送方收到一个RR帧
  - 选择(SEL) ：当主站点想要向某个从站点发送数据时，它通过发送一个P/F位置1的RNR帧来通知从站点。
  - 对选择的否定应答(SEL.NAK) ：当选择的从设备不能接收数据时，它回答一个P/F置1的RNR帧。
- 拒绝(REJ)帧和选择拒绝(SREJ)帧：
  - REJ：在**回退N自动重传请求**中，当接收方没有要发送的数据来捎带应答信息时，返回一个REJ帧。在REJ帧中，N(R)域指明了损坏帧的序号，**损坏帧及其以后所有帧**必须重发。
  - SREJ：在**选择拒绝自动重传请求**中，当接收方收到一个损坏帧时，返回一个SREJ帧，N(R)域指明了被损坏帧的编号。**被损坏的帧**需要重发。

3. 无编号帧的种类：无编号帧的控制字段中有5位编码位，这5个编码位可用来表示32种不同类型的无编号帧。 包含5个基本功能类：

​		方式设置，无序号交互，断开连接，启动模式，混杂形式

4. 例子![IMG_31CD94B0484C-1](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgIMG_31CD94B0484C-1.jpeg)

### IEEE局域网通信协议

1. IEEE 802 局域网标准

   <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228113535138.png" alt="image-20230228113535138" style="zoom: 33%;" />

2. 逻辑链路控制LLC

   <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228114140413.png" alt="image-20230228114140413" style="zoom: 33%;" />

- LLC帧的帧首中，使用 DSAP和 SSAP，该地址是逻辑地址，是数据链路层的不同服务访问点
- LLC子层向上层可提供3种服务；
  - 非确认的无连接服务：不需要确认，质量保证由高层完成
  - 面向连接服务：有3个阶段，连接建立、数据传输、连接释放
  - 确认的无连接服务：对数据帧提供确认，但传输前无连接建立过程

### ==以太网==

1. 基带和宽带：基带类使用数字信号传输数据，宽带类使用模拟信号传输数据

- IEEE将基带类划分为5个不同的标准：
  - 总线型拓扑：10Base5（粗缆以太网）、10Base2（细缆以太网）
  - 星状拓扑：10Base-T（双绞线以太网）、100base-T（快速以太网）。   

- 开头数字指明了数据传输速率；最后的数字或字母(5，2，T)指明了最大电缆长度或电缆的类别；base指明的是基带传输。
- IEEE定义了一个宽带类标准：10Broad36，用于小区网络连接。

2. ==以太网访问模式CSMA/CD==

   ![image-20230228114836753](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228114836753.png)

- CSMA/CD的算法描述：

​		如果链路是空闲的，则可以发送并同时检测冲突。

​		如果链路是忙的，则继续侦听，直到检测到链路空闲。

​		如果在发送过程中检测到冲突，则停止当前帧的发送，发阻塞信号，等待一段选定的时间(由退避算法决定)。

- 最短帧长：F~min~=2R×D/V   争用期*信道带宽

  F~min~：最短数据帧长（bit）R：数据传输速率（bps）D：任意两站点间的最大距离（m）V：电子传播速度（m/s） 

- CSMA/CD退避算法

  <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228115611222.png" alt="image-20230228115611222" style="zoom: 33%;" />

- 以太网MAC帧

  <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228130255685.png" alt="image-20230228130255685" style="zoom:67%;" />

### 无线局域网

1. 无线链路的重要特征
    递减的信号强度、来自其他信号源的干扰、多径传播

   2. 暴露站和隐蔽站问题

      <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228120352988.png" alt="image-20230228120352988" style="zoom: 33%;" />

​								<img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230228120411329.png" alt="image-20230228120411329" style="zoom: 33%;" />

3.CSMA/CA协议

- CSMA/CA工作原理：如果某站点有数据要发送，它首先侦听信道：

  如果信道空闲，继续等待IFS(帧间隔)时间，然后再侦听信道；如果信道仍然空闲，立即发送数据

  如果信道忙，该站点继续侦听信道，直到当前传输完全结束

  一旦当前传输结束，站点继续等待IFS时间，然后再侦听信道，如果信道仍然保持空闲，站点按指数后退一个随机长的时间后，发送数据。

- 冲突避免：CSMA/CA的关键在于冲突避免。采用了3种机制来实现：

  - 预约信道： 使用RTS/CTS机制(请求发送/允许发送) ，向其它站发出通告，本站将占用多长时间，其它站不要发送数据并调整其网络分配向量NAV（信道处于忙状态的时间），以免冲突。可以解决隐藏站问题。

  - 正向确认：接收站正确收到数据要发确认帧，否则源站点重复发送数据帧。

### 数据链路层网络互连

1. 网桥

- 路由功能：网桥具有根据帧的目的地址决定是否接受该帧的功能，也就是具有路由的功能。

- 错误检测和帧格式转换功能：n由于网桥工作在数据链路层，因此可以将数据链路层不一致的帧转换。

- 隔离通信功能：网桥和中继器的不同之处：网桥具有隔离通信（**碰撞域**）的功能。 

  注：第二层交换机是多接口网桥

2.网桥路由算法

- 固定路由网桥：每个网桥中都有一张路由表。路由表的生成是由手工配置的，一旦配置完成，路由表不会变动。

- 透明网桥：采用逆向学习算法能够根据网络信息**自动生成和修改自己的路由表**，这种能力称为路由学习(Route Learning)或地址学习(Address Learning)。

  - 路由表的初始化：当网桥收到一个发往某站点的帧，而在路由表中没有该站点的路由信息时，网桥使用一个扩散算法向它所连接的所有局域网发送这个帧。
  - 路由表的自动修改：任何时候当它接收到一个帧时，它检查帧的源地址。然后就知道发送这个帧的站点可以通过这个帧刚到达的局域网来访问。

  - 帧循环问题：当一个互连局域网有回路时，就可能会产生帧的循环传递问题。这种过程继续下去，将导致帧的爆炸

  - **生成树算法**

    - 先确定根网桥

    - 查找网桥到根的最短费用，选举根端口

    - 确定每个网络连接的网桥，选举指定端口

​			注：只计算网桥到局域网到费用，局域网到网桥费用为0

- 源路由网桥：让发送帧的源站点决定转发路由，而不是由网桥来决定

3. 虚拟局域网(VLAN)：

   - 端口的分隔。即便在同一个交换机上，处于不同VLAN的端口也是不能通信的。这样一个物理的交换机可以当作多个逻辑的交换机使用。
   - 网络的安全。不同VLAN不能直接通信，杜绝了广播信息的不安全性。
   - 灵活的管理。更改用户所属的网络不必换端口和连线，只更改软件配置就可以了。



## 第五章 网络层

### 网络层的功能和服务类型

1. 网络层的功能：信源到信宿的传输，逻辑寻址，路由，地址转换，复用，流量和拥塞控制，网络互连
2. 两种服务类型

- 面向连接的服务(CONS)

  面向连接的网络服务为数据传输建立一条**虚电路**，该电路在整个数据传输过程中都是有效的，一次数据传输过程的所有包都将按顺序沿着已建立的虚电路传输

- 面向无连接的服务(CLNS)

  在面向无连接的网络服务中，一次多包传输中，每个包被当作一个独立的单元。无连接协议**不提供逻辑连接**。发送者仅仅是发送数据，不需要提醒接收者有通信即将到来。中间节点根据路由信息和报头地址选择路径

3. 广播路由选择算法：**N次单播、无控制洪泛法、受控洪泛法、生成广播树**

### 网络层互连设备

1. 路由器

   路由器工作在网络层，在多个互连设备之间中继包（从一个网络接口接收，从另一个网络接口发送），路由器对来自某个网络的包确定传输路径，发送到互连网络中任何可能的目的网络中

2. 第三层交换机
3. 网关：网关是一个协议转换器，通常是安装在路由器内部的软件，可以工作在OSI的7层。

### ==路由选择协议==

1. **距离向量路由**（RIP）

- 每个路由器保存关于整个网络的信息 
- 仅仅和邻居交换网络信息 
- 信息的交换是通过有规律的时间间隔来进行(例如每隔30秒发一次)，无论网络状态是否发生变化

2. **链路状态路由** （OSPF）

- 共享关于邻居的信息
- 共享的信息发给所有的路由器(扩散法)
- 共享信息在有规律的时间间隔内进行(一般30分钟)
- 使用Dijkstra算法找出最短路径

注：费用仅计算路由器到网络的部分，网络到路由器的费用不计。

### 拥塞控制和流量控制

1. 拥塞控制

- 预分配缓冲区：常用于虚电路技术中，虚电路的建立会通知该节点为此虚电路预留缓冲区。 

- 丢弃包：节点上收到过多的包而来不及处理或无法发送出去时，可丢弃一部分包。对突发性通信造成的拥塞有效。常用机制：RED

  <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230301114402056.png" alt="image-20230301114402056" style="zoom:67%;" />

- 限制网内包数量：限制进入网内的包的数目

- 阻塞包

​	注：流量控制是端到端，拥塞控制涉及中间节点

2. 流量控制

- 主机和源节点间的流量控制：通过控制进入通信子网的信息量，从而防止整个网内的缓冲区产生拥塞
- 源节点和目的节点之间的流量控制：当通信子网采用数据报方式工作，而缓冲区分配采用先来先服务且全部分配的方法，则有可能产生存储转发死锁。解决办法：输入链路预留缓存，并允许丢包；重装死锁：分配重装缓冲、并预约缓冲。

### ==IP协议==

IP协议为高层提供不可靠、无连接的数据报通信（尽最大努力交付）。

1. ==IP地址==

   IPv4地址长度32位，IPv6地址长度128位

   ![image-20230301121405000](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230301121405000.png)

2. IP报文格式

   <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230301140424463.png" alt="image-20230301140424463" style="zoom: 50%;" />

- 版本：IP协议的版本，目前的IP协议版本号为4，下一代IP协议版本号为6。

- 首部长度：IP报头的长度。**以4字节为单位**(一般是20字节，即该字段的值为5)。最长可60字节，固定部分长度20字节，可变部分长度最大为40字节。

- 服务类型：Type Of Service。

- 总长度：IP报文的总长度，报头的长度和数据部分的长度之和，以字节为单位，最大长度65536字节，**以太网中IP最大长度1500字节**。

- 标识：唯一的标识主机发送的每一个数据报。通常每发送一个报文，它的值加一。（该字段不是序号）

- 标志：共3位。R、DF、MF三位。目前只有后两位有效，DF位：为1表示不分片，为0表示分片。MF：为1表示“还有更多的片”，为0表示这是最后一片。

- ==片位移==：本分片在原先数据报文中相对首位的偏移位，以 8字节为单位。（数据报进行分段的主机或路由器必须选择每一个分段的长度能够**被8除尽**）

- 生存时间：IP报文所允许通过的路由器的最大数量。每经过一个路由器，TTL减1，当为0时，路由器将该数据报丢弃。

- 协议字段：IP数据报的上层携带的协议。

  <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230301142237232.png" alt="image-20230301142237232" style="zoom: 50%;" />

- 首部校验和：计算IP头部的校验和，检查IP报头的完整性。
- 源IP地址：标识IP数据报的源IP地址。
- 目的IP地址：标识IP数据报的目的IP地址。

3. ==子网编址和子网掩码==

- 子网划分

  子网掩码是一个32比特的数值，其中值为1的比特对应网络号和子网号，为0的比特对应主机号。

![image-20230301142714826](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230301142714826.png)

- **CIDR编址**

  128.14.32.0**/**20 （因为**斜线后面的 20 是网络前缀的位数**，所以这个地址的主机号是 12 位）

- 路由聚合（构造超网）

  在路由表中找最长的公共前缀（最长前缀匹配）

### ARP协议

1. 基本功能：ARP协议的基本功能就是通过目的设备的IP地址，查询目标设备的MAC地址。

2. 工作原理：ARP协议的请求包是以广播方式发送的。网段中的所有主机都会接收到这个包，如果一个主机的IP地址和ARP请求中的目的IP地址相同，该主机会对这个请求数据包作出ARP应答，将其MAC地址发送给源端。

3. ARP高速缓存

   ARP高速运行的关键是由于每个主机上都有一个ARP高速缓存。这个高速缓存存放了最近Internet地址到硬件地址之间的映射。

### ICMP：Internet控制报文协议

1. ICMP数据报封装在IP数据报里传输

​		ICMP协议有两种报文：查询报文，差错报文

​		对错误的ICMP差错报文不会产生另一个ICMP差错报文

2. 实际应用：Ping，Tracert
3. 源点抑制：当路由器或主机因拥塞而丢弃数据报时，它就向数据报的发送站发送源点抑制报文。它通知源端，数据报已被丢弃。并警告源端，在路径中的某处出现了拥塞，因而源端必须放慢发送过程

### IGMP：Internet组管理协议

1. IP地址有三种类型，分别是：单播地址，广播地址，多播地址，其中广播和多播地址仅应用于UDP协议。
2. IGMP是TCP/IP协议族中负责 IP多播成员管理的协议，用来在 IP主机和与其直接相邻的组播路由器之间建立、维护多播组成员关系。



## 第六章 传输层

### 传输层服务

1. 传输层位于**通信子网**和**资源子网**之间，是整个协议层次中最核心的一层。传输层为源主机上的进程和目的主机上的进程之间提供**可靠的透明数据传送**，使高层用户在相互通信时不必关心通信子网实现的细节。

2. 传输层功能：端到端的报文传递，服务点的寻址，拆分和组装，连接控制

3. 传输层为上层提供两种类型服务：面向连接的传输服务，面向无连接的传输服务

4. 传输层流量控制：传输层中的流量控制是作用在**端到端**上的，而不是作用在单条链路上。传输层流量控制使用**窗口大小可以变的滑动窗口协议**

   <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230302091338129.png" alt="image-20230302091338129" style="zoom: 50%;" />

### 用户数据报协议UDP

1. UDP采用**非连接**的方式提供网络应用层的事务处理。
2. UDP协议不提供端到端的确认和重传功能，它不保证数据包一定能到达目的地，因此称为**不可靠协议**。

3. UDP必须在IP上运行，UDP数据报封装在IP数据报中，利用IP协议传输。

4. UDP特点：端到端，无连接，面向报文，尽力而为，任意交互，操作系统无关。

5. UDP允许采用4种交互通信方式：一对一，一对多，多对一，多对多。

6. UDP报头

   <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230302093156158.png" alt="image-20230302093156158" style="zoom:50%;" />

- 伪报头：12字节，包含IP报头的某些域，目的是让UDP 检测数据确已到达正确的目的端。
- 源端口号：可选字段，该端口号作为接收进程返回数据时的目的端口。
- 目的端口号：该端口号是作为接收主机内与特定应用进程相关联的地址。
- 报文长度：指UDP首部和UDP数据的字节长度，即IP全长减去IP首部的长度，最小值为8。
- 检验和：可选字段，用来检验传输过程中是否出现错误。校验和覆盖伪首部、 UDP首部和UDP数据。

### ==传输控制协议TCP==

1. TCP提供了一种可靠的面向连接的字节流传输层服务，提供端到端的流量控制。

2. TCP特点：面向连接，点对点（一对一），完全的可靠性，全双工通信，流接口，可靠的连接建立，友好的连接关闭，**超时重传、捎带应答、拥塞控制**。

2. 在TCP协议中，只需确认数据流中的第一个丢失字节为止的字节，这种确认方式称为**累积确认**

3. TCP报头

   <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230302094803858.png" alt="image-20230302094803858" style="zoom:50%;" />

- 端口字段：源端口和目的端口字段各占 2 字节。端口是传输层与应用层的服务接口。传输层的复用和分用功能都要通过端口才能实现。 
- **序号字段**：占4字节，TCP连接中传送的数据流中的每一个字节都编上一个序号。序号字段的值则指的是本报文段所发送的数据的第一个字节的序号。

- 确认号字段：占4字节，是期望收到对方的下一个报文段的数据的第一个字节的序号。 
- 数据偏移(即首部长度)：占4位，指出数据起始处距离 TCP 报文段起始处的距离，以 4 字节为计算单位。
- URG紧急，**ACK确认**，PSH推送，RST复位，**SYN同步**，**FIN终止**。
- 窗口字段：占2字节，用来让对方设置发送窗口的依据，单位为字节。
- 检验和：占2字节。检验和字段检验的范围包括首部和数据。在计算检验和时，要在TCP报文段的前面加上12字节的伪首部。
- 紧急指针字段：占16位，是一个正的偏移量，指出在本报文段中紧急数据共有多少个字节(紧急数据放在本报文段数据的最前面)，和序号字段中的值相加表示紧急数据最后一个字节的序号。
- 选项字段：即最大报文段长度 MSS。

4. 超时重传

   ![image-20230302101643299](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230302101643299.png)

5. ==TCP连接的建立和释放==

   ![IMG_F24C8C400B30-1](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgIMG_F24C8C400B30-1.jpeg)

   ![IMG_FDBB8BCBBFF9-1](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgIMG_FDBB8BCBBFF9-1.jpeg)

6. ==TCP拥塞控制==

    拥塞窗口cwnd，慢启动阀值ssthresh，接收端窗口rwnd

   ![image-20230302103037608](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230302103037608.png)

​		发送窗口的上限值=min(rwnd,cwnd)



## 第七章 应用层

### DHCP协议

1. 动态主机配置协议，它提供了一种动态指定IP地址和配置参数的机制，用于简化主机 IP 配置管理。通过采用 DHCP，可以使用 DHCP 服务器为网络上启用了 DHCP 的客户端**管理动态 IP 地址分配和其它相关配置细节**（IP地址，子网掩码，默认网关IP地址，DNS服务器IP地址 ）

2. 工作原理：DHCP 使用客户/服务器模型，指定的DHCP服务器负责分配IP地址，并将配置参数传送为DHCP客户。DHCP使用**UDP**协议，服务器端使用67号端口，客户端使用UDP的68号端口。

3. 3种IP地址分配机制：自动分配（永久地址），动态分配（临时地址），人工分配

4. 工作过程：请求IP地址，续租IP地址，释放IP地址

   注：DHCP客户在未请求到IP地址时使用地址0.0.0.0

### DNS服务

1. 域名系统：一个分布式的数据库，每个子域负责维护整个数据库的一个分段。

2. 域名空间

   ![IMG_739C5076D1B2-1](https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgIMG_739C5076D1B2-1.jpeg)

3. DNS采用客户/服务器工作模式，提供域名到IP地址的映射和反向查询。
4. ==域名解析过程==

- 域名解析器首先查询**本地主机的的缓冲区**，查看主机是否以前解析过主机名。

- 如果主机缓冲区中没有与其IP地址的映射关系，解析器将向**本地域名服务器**发出请求。

- 本地域名服务器首先检查域名与其IP地址的映射关系是否存储在它的数据库中，如果是，本地服务器将该映射关系传送给请求者；否则向上层根服务器查询。

  - 迭代查询

    <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230302111312420.png" alt="image-20230302111312420" style="zoom:50%;" />

  - 递归查询

    <img src="https://picbed-983735321.oss-cn-beijing.aliyuncs.com/imgimage-20230302111346543.png" alt="image-20230302111346543" style="zoom:50%;" />

### 电子邮件服务

1. 一个电子邮件系统由3部分组成：
   - 用户代理：用户与电子邮件系统的接口，是用户机上运行的程序。
   - 邮件服务器：收发邮件，运行邮件服务程序。
   - 电子邮件协议： SMTP、POP3

​	注：电子邮件不是一种“终端到终端”的服务，而是一种“存贮转发式”服务。

2. 简单邮件传输协议SMTP

- SMTP使用**基于TCP链接的客户/服务器模式，使用熟知端口号25**
- SMTP协议只能传送ASCII文本，多用途因特网扩展协议MIME可以传送其他多媒体文件

3. 接收邮件协议

- 邮局协议POP

  用户只能以**下载并删除方式**或**下载并保留方式**从邮件服务器下载邮件到用户计算机，不允许用户在邮件服务器上管理自己的邮件，是脱机程序。

- 因特网邮件访问协议IMAP

  联机协议，用户在自己的计算机上就可以操控邮件服务器中的邮箱。

- POP3和IMAP4都采用基于TCP链接的客户/服务器模式，POP3使用熟知端口号110，IMAP4使用熟知端口号143。

### 文件服务FTP

1. FTP是基于TCP的文件传输协议，用于在两台**异构**的主机间传输文件，可靠性由TCP保障。
2. FTP是一个客户机/服务器系统，用户通过一个支持FTP协议的客户机程序，连接到在远程主机上的FTP服务器程序。

3. 当FTP客户端与服务器建立FTP连接时，将与服务器上的两个端口建立联系

   - ==端口21==用于控制连接，如用户标识、操作命令

   - ==端口20==用于数据连接

   在一次会话中，**控制始终保持**，数据连接随文件的传输会不断地打开与关闭。

4. FTP的两种工作方式
   - 主动(PORT)模式：建立数据通道时，FTP服务器主动连接FTP客户
   - 被动(PASV)模式：建立数据通道时，FTP服务器被动等待FTP客户的连接

### WEB服务

1. 超文本：HTML超文本标记语言

   统一资源定位器(URL)：标识网络上资源位置而设计的一种编址方式。一般由3部分组成：传输协议://主机地址[:port]/路径和文件名

2. ==超文本传输协议HTTP==

- HTTP以普通文本、超文本、音频、视频等格式传输数据。通常在==端口80==上使用TCP服务。

- HTTP是典型的客户/服务器模式。客户是浏览器，服务是WWW服务器。
- HTTP协议是无状态协议，不保留客户的状态。

- HTTP协议有持续连接（HTTP/1.1）和非持续连接（HTTP/1.0）。

